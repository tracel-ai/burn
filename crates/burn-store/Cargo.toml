[package]
authors = ["Dilshod Tadjibaev (@antimora)"]
categories = ["science", "no-std", "embedded", "wasm"]
description = "Storage and serialization infrastructure for Burn"
documentation = "https://docs.rs/burn-store"
edition.workspace = true
keywords = [
    "deep-learning",
    "machine-learning",
    "tensor",
    "storage",
    "serialization",
]
license.workspace = true
name = "burn-store"
readme.workspace = true
repository = "https://github.com/tracel-ai/burn/tree/main/crates/burn-store"
version.workspace = true

[lints]
workspace = true

[features]
default = ["std", "pytorch", "burnpack", "memmap"]
# std feature enables safetensors with std feature
# Note: Don't enable both 'std' and 'safetensors' features - std implies safetensors support
std = ["dep:memmap2", "dep:safetensors", "safetensors?/std", "burn-core/std", "burn-tensor/std", "dep:regex", "byteorder/std"]
memmap = ["std", "dep:memmap2"]
burnpack = ["serde", "ciborium"]
wgpu = ["burn-wgpu"]
metal = ["wgpu", "burn-wgpu/metal"]
cuda = ["burn-cuda"]
candle = ["burn-candle"]
tch = ["burn-tch"]
# safetensors feature for no-std builds (enables alloc)
# WARNING: Do not combine with 'std' feature - they are mutually exclusive
# Use 'std' for std builds (includes safetensors), or 'safetensors' for no-std builds
safetensors = ["dep:safetensors", "safetensors?/alloc"]
pytorch = ["burn-core/record-item-custom-serde", "zip", "serde"]

[dependencies]
burn-core = { path = "../burn-core", version = "0.19.0", default-features = false }
burn-nn = { path = "../burn-nn", version = "0.19.0", default-features = false }
burn-tensor = { path = "../burn-tensor", version = "0.19.0", default-features = false }

# External dependencies
byteorder = { workspace = true, default-features = false }
half = { workspace = true }
hashbrown = { workspace = true, features = ["serde"] }
memmap2 = { workspace = true, optional = true }
regex = { workspace = true, optional = true }
ciborium = { workspace = true, optional = true }
serde = { workspace = true, optional = true }
zip = { workspace = true, optional = true }

# Safetensors dependency - features are added conditionally
# See: https://github.com/huggingface/safetensors/issues/650
# std and alloc are mutually exclusive, managed via feature flags
safetensors = { workspace = true, optional = true }

# Optional backend dependencies for benchmarks
burn-candle = { path = "../burn-candle", version = "0.19.0", optional = true }
burn-cuda = { path = "../burn-cuda", version = "0.19.0", optional = true }
burn-tch = { path = "../burn-tch", version = "0.19.0", optional = true }
burn-wgpu = { path = "../burn-wgpu", version = "0.19.0", optional = true }

[dev-dependencies]
burn = { path = "../burn", version = "0.19.0" }
burn-import = { path = "../burn-import", version = "0.19.0" }
burn-ndarray = { path = "../burn-ndarray", version = "0.19.0" }
divan = "0.1"
tempfile = { workspace = true }

[[bench]]
name = "resnet18_loading"
harness = false

[[bench]]
name = "unified_loading"
harness = false

[[bench]]
name = "unified_saving"
harness = false
