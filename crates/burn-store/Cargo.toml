[package]
authors = ["Dilshod Tadjibaev (@antimora)"]
categories = ["science", "no-std", "embedded", "wasm"]
description = "Storage and serialization infrastructure for Burn"
documentation = "https://docs.rs/burn-store"
edition.workspace = true
keywords = [
    "deep-learning",
    "machine-learning",
    "tensor",
    "storage",
    "serialization",
]
license.workspace = true
name = "burn-store"
readme.workspace = true
repository = "https://github.com/tracel-ai/burn/tree/main/crates/burn-store"
version.workspace = true

[lints]
workspace = true

[features]
# Note: safetensors support is always included via either std or safetensors feature
default = ["std", "pytorch", "burnpack", "memmap"]
# std feature uses the crates.io version with std feature
std = ["dep:memmap2", "dep:safetensors-std", "burn-core/std", "burn-tensor/std", "dep:regex", "byteorder/std"]
memmap = ["std", "dep:memmap2"]
burnpack = ["serde", "ciborium"]
wgpu = ["burn-wgpu"]
metal = ["wgpu", "burn-wgpu/metal"]
cuda = ["burn-cuda"]
candle = ["burn-candle"]
tch = ["burn-tch"]
# safetensors feature for no-std builds (uses crates.io version with alloc feature)
safetensors = ["dep:safetensors-nostd"]
pytorch = ["burn-core/record-item-custom-serde", "zip", "serde"]

[dependencies]
burn-core = { path = "../burn-core", version = "0.19.0", default-features = false }
burn-nn = { path = "../burn-nn", version = "0.19.0", default-features = false }
burn-tensor = { path = "../burn-tensor", version = "0.19.0", default-features = false }

# External dependencies
byteorder = { workspace = true, default-features = false }
half = { workspace = true }
hashbrown = { workspace = true, features = ["serde"] }
memmap2 = { workspace = true, optional = true }
regex = { workspace = true, optional = true }
ciborium = { workspace = true, optional = true }
serde = { workspace = true, optional = true }
zip = { workspace = true, optional = true }

# Dual safetensors dependencies to support both std and no-std
# See: https://github.com/huggingface/safetensors/issues/650
#
# For std builds: use crates.io version 0.6.2 with std feature
safetensors-std = { package = "safetensors", version = "0.6.2", default-features = false, features = ["std"], optional = true }
# For no-std builds: use crates.io version 0.6.2 with alloc feature
safetensors-nostd = { package = "safetensors", version = "0.6.1", default-features = false, features = ["alloc"], optional = true }

# Optional backend dependencies for benchmarks
burn-candle = { path = "../burn-candle", version = "0.19.0", optional = true }
burn-cuda = { path = "../burn-cuda", version = "0.19.0", optional = true }
burn-tch = { path = "../burn-tch", version = "0.19.0", optional = true }
burn-wgpu = { path = "../burn-wgpu", version = "0.19.0", optional = true }

[dev-dependencies]
burn = { path = "../burn", version = "0.19.0" }
burn-import = { path = "../burn-import", version = "0.19.0" }
burn-ndarray = { path = "../burn-ndarray", version = "0.19.0" }
divan = "0.1"
tempfile = { workspace = true }

[[bench]]
name = "resnet18_loading"
harness = false

[[bench]]
name = "unified_loading"
harness = false

[[bench]]
name = "unified_saving"
harness = false
